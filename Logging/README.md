# Логирование приложения в Yandex Cloud

## Общие сведения

Для проекта используется **Yandex Logging** — встроенный сервис логирования Yandex Cloud, который **автоматически собирает логи** для serverless контейнеров. Логи доступны сразу после развёртывания, без дополнительной настройки.

## Что уже работает автоматически

✅ **Логи backend serverless контейнера** собираются автоматически  
✅ **Логи доступны в веб-консоли** Yandex Cloud  
✅ **Поиск и фильтрация логов** работает из коробки  
✅ **Логи API Gateway** также доступны автоматически  

## Где найти логи

1. Откройте [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Перейдите в раздел **Logging**
3. Выберите нужный ресурс:
   - **Serverless Containers** → ваш backend контейнер
   - **API Gateway** → ваш API Gateway

## Что можно настроить (опционально)

### 1. Экспорт логов в Object Storage

Для долгосрочного хранения и анализа:

1. В разделе **Logging** → **Export**
2. Создайте экспорт в Object Storage
3. Настройте:
   - Бакет для хранения логов
   - Формат (JSON, текстовый)
   - Периодичность экспорта
   - Retention (срок хранения)

### 2. Настройка retention (срок хранения)

По умолчанию логи хранятся ограниченное время. Можно настроить:

1. В настройках **Logging**
2. Установить срок хранения логов
3. Настроить автоматическое удаление старых логов

### 3. Интеграция с внешними системами

Через Yandex Logging API можно:
- Получать логи программно
- Интегрировать с внешними системами (ELK, Splunk и т.д.)
- Настроить webhook для отправки логов

## Какие логи доступны

### Backend Serverless Container

**Типы логов:**
- **stdout/stderr** — стандартный вывод приложения
- **Логи FastAPI** — логи фреймворка (запросы, ошибки)
- **Логи контейнера** — системные логи контейнера
- **Ошибки выполнения** — ошибки при запуске/выполнении контейнера

**Что искать в логах:**
- HTTP запросы (метод, путь, статус код)
- Ошибки приложения (traceback, исключения)
- Время выполнения запросов
- Использование ресурсов

### API Gateway

**Типы логов:**
- **Access logs** — логи доступа (запросы, ответы)
- **Ошибки проксирования** — проблемы при обращении к backend
- **CORS ошибки** — проблемы с CORS

**Что искать в логах:**
- Входящие запросы к API Gateway
- Ответы от backend контейнера
- Ошибки 4xx, 5xx
- Время обработки запросов

### Object Storage (Frontend)

**Типы логов:**
- **Access logs** — логи доступа к файлам
- **Ошибки доступа** — 404, 403 и т.д.

## Поиск и фильтрация логов

### Базовый поиск

В интерфейсе Yandex Logging можно использовать:

- **Поиск по тексту** — найти конкретные сообщения
- **Фильтры по времени** — выбрать временной диапазон
- **Фильтры по уровню** — ERROR, WARNING, INFO
- **Фильтры по ресурсу** — конкретный контейнер или API Gateway

### Примеры запросов

**Найти все ошибки:**
```
level:ERROR
```

**Найти запросы к конкретному endpoint:**
```
"/api/skills"
```

**Найти ошибки за последний час:**
```
level:ERROR AND timestamp > now() - 1h
```

## Рекомендации

1. **Регулярно проверяйте логи** на наличие ошибок и предупреждений
2. **Настройте экспорт** в Object Storage для долгосрочного хранения (если требуется)
3. **Используйте фильтры** для быстрого поиска проблем
4. **Мониторьте ошибки** — настройте алерты на критические ошибки в логах (через Yandex Monitoring)

## Структурированное логирование

Для лучшего анализа рекомендуется использовать структурированные логи в приложении:

**Пример для FastAPI:**
```python
import logging
import json

logger = logging.getLogger(__name__)

# Структурированный лог
logger.info(json.dumps({
    "event": "api_request",
    "method": "GET",
    "path": "/api/skills",
    "status_code": 200,
    "duration_ms": 45
}))
```

Это упростит поиск и анализ логов в Yandex Logging.

## Полезные ссылки

- [Документация Yandex Logging](https://yandex.cloud/ru/docs/logging/)
- [Логирование serverless контейнеров](https://yandex.cloud/ru/docs/serverless-containers/operations/logs)
- [Экспорт логов](https://yandex.cloud/ru/docs/logging/operations/export)
- [Yandex Logging API](https://yandex.cloud/ru/docs/logging/api-ref/)

