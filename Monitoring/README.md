# Мониторинг приложения в Yandex Cloud

## Общие сведения

Для проекта используется **Yandex Monitoring** — встроенный сервис мониторинга Yandex Cloud, который автоматически собирает метрики для serverless контейнеров. Настройка дашбордов и алертов выполняется **вручную через веб-консоль**, так как Terraform провайдер не поддерживает создание дашбордов и алертов напрямую.

## Почему вручную?

- Terraform провайдер Yandex Cloud не поддерживает ресурсы для создания дашбордов и алертов
- Метрики собираются автоматически, требуется только визуализация и настройка уведомлений
- Веб-консоль предоставляет удобный интерфейс для настройки и тестирования дашбордов

## Что настраивать

### 1. Дашборды (Dashboards)

Создайте дашборды в Yandex Monitoring для визуализации метрик:

#### Backend Serverless Container

**Основные метрики для отслеживания:**

- **`serverless_container.invocations`** — количество вызовов контейнера
- **`serverless_container.duration`** — время выполнения запросов (латентность)
- **`serverless_container.errors`** — количество ошибок (5xx, таймауты)
- **`serverless_container.memory_used_bytes`** — использование памяти
- **`serverless_container.cpu_used`** — использование CPU
- **`serverless_container.concurrent_executions`** — количество одновременных выполнений

**Рекомендуемые графики:**
- График количества запросов в секунду (RPS)
- График времени ответа (p50, p95, p99)
- График ошибок по типам
- График использования ресурсов (CPU, Memory)

#### API Gateway

**Метрики для отсрыживания:**

- **`api_gateway.requests`** — количество запросов через API Gateway
- **`api_gateway.latency`** — задержка обработки запросов
- **`api_gateway.errors`** — количество ошибок (4xx, 5xx)
- **`api_gateway.backend_latency`** — задержка ответа от backend контейнера

### 2. Алерты (Alerts)

Настройте алерты для критических ситуаций:

#### Критические алерты (высокий приоритет):

1. **Высокая латентность backend**
   - Условие: `serverless_container.duration > 5000ms` (p95)
   - Действие: уведомление в Telegram/Email

2. **Высокий процент ошибок**
   - Условие: `(serverless_container.errors / serverless_container.invocations) * 100 > 5%`
   - Действие: уведомление в Telegram/Email

3. **Превышение лимита памяти**
   - Условие: `serverless_container.memory_used_bytes > 80% от выделенной памяти`
   - Действие: уведомление в Telegram/Email

4. **Недоступность API Gateway**
   - Условие: `api_gateway.errors > 10 за последние 5 минут`
   - Действие: уведомление в Telegram/Email

#### Предупреждающие алерты (средний приоритет):

1. **Рост количества запросов**
   - Условие: `serverless_container.invocations > среднее значение за последний час * 2`
   - Действие: уведомление в Email

2. **Высокое использование CPU**
   - Условие: `serverless_container.cpu_used > 70%`
   - Действие: уведомление в Email

### 3. Object Storage (Frontend)

Для статического фронтенда в Object Storage отслеживайте:

- **`storage.bucket.requests`** — количество запросов к бакету
- **`storage.bucket.errors`** — ошибки доступа к файлам
- **`storage.bucket.data_transfer`** — объём переданных данных

## Инструкция по настройке

### Создание дашборда

1. Откройте [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Перейдите в раздел **Monitoring**
3. Нажмите **Create dashboard**
4. Добавьте виджеты с метриками serverless контейнеров
5. Сохраните дашборд

### Создание алерта

1. В разделе **Monitoring** выберите **Alerts**
2. Нажмите **Create alert**
3. Настройте условие срабатывания (query, threshold)
4. Выберите канал уведомлений (Email, Telegram, Webhook)
5. Сохраните алерт

### Настройка каналов уведомлений

1. В разделе **Monitoring** → **Notification channels**
2. Добавьте каналы:
   - Email (ваш email)
   - Telegram (бот и chat ID)
   - Webhook (для интеграции с внешними системами)

## Метрики для нашего проекта

### Backend (FastAPI)

**Ключевые метрики:**
- Количество запросов к API endpoints (`/api/about`, `/api/skills`, `/api/projects`, `/api/contacts`)
- Время ответа API
- Количество ошибок (4xx, 5xx)
- Использование ресурсов контейнера

**Кастомные метрики (если добавим):**
- Количество успешных запросов
- Количество запросов по типам (GET, POST)
- Размер ответа

### Frontend (Object Storage)

**Ключевые метрики:**
- Количество загрузок `index.html`
- Количество загрузок статических ресурсов (CSS, JS)
- Ошибки 404 (отсутствующие файлы)
- Объём переданных данных

## Рекомендации

1. **Начните с базовых метрик**: количество запросов, время ответа, ошибки
2. **Настройте критические алерты** для быстрого реагирования на проблемы
3. **Регулярно проверяйте дашборды** для выявления трендов и аномалий
4. **Документируйте** настройки алертов для команды

## Полезные ссылки

- [Документация Yandex Monitoring](https://yandex.cloud/ru/docs/monitoring/)
- [Метрики serverless контейнеров](https://yandex.cloud/ru/docs/serverless-containers/operations/metrics)
- [Настройка алертов](https://yandex.cloud/ru/docs/monitoring/operations/alert/create-alert)

