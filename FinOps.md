# FinOps: стратегии снижения стоимости в Yandex Cloud

Цель — держать витринный проект доступным 24/7, но платить только за реально используемые ресурсы, сохранив возможность масштабировать решение до корпоративного портала.

## 1. Базовые сервисы и текущие расходы

| Компонент | Назначение | Стоимость (оценка) |
|-----------|------------|--------------------|
| Yandex Container Registry | Хранение образов frontend/backend | ₽ до ~120 ₽/мес при 5–10 образах |
| Serverless Containers | Backend/Frontend API | ₽ по микросекундам; при низкой нагрузке → копейки |
| Terraform state/storage | Управление IaC | Бесплатно (локально) |

Узкое место — отсутствие постоянного домена/прокси. Прямой доступ к контейнерам даёт рандомный URL и усложняет деплой.

## 2. Варианты «front door»

### 2.1 Object Storage + Cloud CDN + API Gateway (текущий план)
* **Frontend**: React билд лежит в бакете (`kulibin-devops-portfolio.website.yandexcloud.net`), при необходимости навешиваем CDN/домен.  
* **Backend**: Yandex API Gateway проксирует `https://api.example.ru` → serverless backend.  
* **Плюсы**: минимальная стоимость, полностью serverless, легко скейлиться.  
* **Минусы**: две сущности (CDN + Gateway), нужно продумать CORS/авторизацию.

### 2.2 Application Load Balancer
* **Плюсы**: единый домен и маршрутизация (`/` и `/api/*`), строгий контроль доступа.  
* **Минусы**: фиксированная абонплата ~1.5–2 ₽/час (~1100–1500 ₽/мес) даже без трафика.

### 2.3 Network Load Balancer + собственный прокси
* **Плюсы**: дешевле ALB (₽1/час), можно держать прокси в serverless container/VM.  
* **Минусы**: нет L7 маршрутизации, нужен отдельный прокси-слой, больше ручной поддержки.

### 2.4 Постоянный «прокси-контейнер»
* **Плюсы**: почти бесплатен, гибок.  
* **Минусы**: придётся самим управлять конфигами, сертификатами, мониторингом. Подходит только как временное решение.

## 3. Стоимость ключевых блоков

| Ресурс | Примерная цена |
|--------|----------------|
| Домен .ru | 200–400 ₽/год |
| Certificate Manager (публичные LE) | 0 ₽ |
| Object Storage (10 ГБ, 100 ГБ трафика) | <50 ₽/мес |
| Cloud CDN (100 ГБ трафика) | ~15–20 ₽/мес |
| API Gateway | ~0.4 ₽ за 1 М вызовов + милисекунды исполнения |
| Application Load Balancer | 1.5–2 ₽/час + трафик |
| Network Load Balancer | ~1 ₽/час + трафик |

## 4. Миграция к enterprise-уровню

1. Текущий шаг: Object Storage + CDN + API Gateway, frontend container выключен (можно вернуть, если понадобится).  
2. При росте нагрузки:  
   - Перевести backend за Application Load Balancer (тот же домен).  
   - Включить WAF/логирование.  
   - Оставить Object Storage + CDN либо перенести фронт в контейнеры/VM.
3. Для приватных сервисов (например, YDB или внутренние API) — использовать ALB/Service Connect + VPC.

## 5. Практические рекомендации

- Вся IaC собрана в `terraform/serverless`: backend контейнер, статический бакет и API Gateway управляются из одного Terraform state.  
- Frontend container оставлен опциональным (флаг `enable_frontend_container`), но по умолчанию используем Object Storage + API Gateway.  
- Секреты/URL backend — через Terraform outputs → Terraform Cloud/Secret Manager → API Gateway.  
- Мониторим реальные затраты через Yandex Cost Management и фиксируем значения в FinOps.md после каждого релиза.

